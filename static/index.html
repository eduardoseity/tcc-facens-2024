<html>
  <head>
    <style>
      body {
        font-family: arial;
        margin: 15px;
        background-color: aliceblue;
      }
      #price {
        font-size: large;
        font-weight: bold;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>TCC Facens 2023</title>
  </head>
  <script>
    function updateData() {
      $.ajax({
        type: 'GET',
        url: '/getTestsCount',
        contentType: 'plain/txt',
        success: (data) => {
          document.getElementById("testsCount").innerHTML = "<i class='fa-solid fa-globe'></i> Total de testes realizados: "+data;
        },
        error: (err) => {
          console.log(err);
        }
      });
    }
  </script>
  <body onload="updateData()">
    <b>Escolha o modelo desejado e insira os dados do imóvel para revelar o preço.</b>
    <br><br>
    <form id="predictForm">
      Modelo<br>
      <select name="model" id="model">
      </select><br><br>
      <script>
        modelSelect = document.getElementById('model');
        modelArray = fetch('/models').then((res) => {
          res.json().then((data) => {
            data['models'].map( (model, i) => {
              let opt = document.createElement("option");
                opt.value = model;
                opt.innerHTML = model;
                modelSelect.append(opt);
            });
          });
        });
      </script>
      <i class="fa-solid fa-chart-area"></i>
      Área total (m²)<br>
      <input type="number" name="totalAreas" id="totalAreas" min="41" max="499" step="1" value="100" oninput="this.nextElementSibling.value = this.value"><br>
      <br>
      <i class="fa-solid fa-house"></i>
      Área útil (m²)<br>
      <input type="number" name="usableAreas" id="usableAreas" min="31" max="399" step="1" value="70" oninput="this.nextElementSibling.value = this.value"><br>
      <br>
      <i class="fa-solid fa-car"></i>
      Vagas<br>
      <input type="range" name="parkingSpaces" id="parkingSpaces" min="0" max="4" value="1" oninput="this.nextElementSibling.value = this.value"><output>1</output><br>
      <br>
      <i class="fa-solid fa-toilet"></i>
      Banheiros<br>
      <input type="range" name="bathrooms" id="bathrooms" min="1" max="5" value="1" oninput="this.nextElementSibling.value = this.value"><output>1</output><br>
      <br>
      <i class="fa-solid fa-bath"></i>
      Suítes<br>
      <input type="range" name="suites" id="suites" min="0" max="5" value="0" oninput="this.nextElementSibling.value = this.value"><output>0</output><br>
      <br>
      <i class="fa-solid fa-bed"></i>
      Quartos<br>
      <input type="range" name="bedrooms" id="bedrooms" min="1" max="4" value="1" oninput="this.nextElementSibling.value = this.value"><output>1</output><br><br>
      
      Bairro<br>
      <select name="neighborhood" id="neighborhood"></select><br><br>
      <script>
        neighborhoodSelect = document.getElementById('neighborhood');
        neighborhoodArray = fetch('/neighborhoods').then((res) => {
          res.json().then((data) => {
            data['neighborhoods'].map( (neighborhood, i) => {
              let opt = document.createElement("option");
                opt.value = neighborhood;
                opt.innerHTML = neighborhood;
                neighborhoodSelect.append(opt);
            });
          });
        });
      </script>

      <input type="hidden" name="condominium" id="condominium" value="0">
      <label>
        <input type="checkbox" name="condominium" id="condominium" value="1"> Condomínio<br>
      </label>
      
      <input type="hidden" name="BARBECUE_GRILL" id="BARBECUE_GRILL" value="0">
      <label>
        <input type="checkbox" name="BARBECUE_GRILL" id="BARBECUE_GRILL" value="1"> Churrasqueira<br>
      </label>

      <input type="hidden" name="POOL" id="POOL" value="0">
      <label>
        <input type="checkbox" name="POOL" id="POOL" value="1"> Piscina<br>
      </label>

      <input type="hidden" name="GYM" id="GYM" value="0">
      <label>
        <input type="checkbox" name="GYM" id="GYM" value="1"> Academia<br>
      </label>

      <input type="hidden" name="BACKYARD" id="BACKYARD" value="0">
      <label>
        <input type="checkbox" name="BACKYARD" id="BACKYARD" value="1"> Quintal<br>
      </label>

      <br>
      <input type="submit" value="Enviar">
    </form>
    <div id="price">
    </div>
    <script>
      $('#predictForm').submit(function(e) {
        e.preventDefault();
        document.getElementById('price').innerHTML = "Aguarde...";
        let model = document.getElementById('model').value;
        let data = {};
        $(this).serializeArray().forEach((item) => {
          data[item["name"]] = item["value"];
        });
        let body = {
          "model":model,
          "data":data
        };
        $.ajax({
          type: 'POST',
          url: '/predict',
          data: JSON.stringify(body),
          contentType: 'application/json',
          dataType: 'text',
          success: (data) => {
            document.getElementById('price').innerHTML = "Preço estimado:<br>"+data;
            updateData();
          },
          error: (err) => {
            console.log(err);
          }
        });
      });
    </script>
    <br>
    <div id="testsCount">
    </div>
    <br>
    <div>
      <i class="fa-brands fa-github"></i> <a href="https://github.com/eduardoseity/tcc-facens-2024">Repositório do projeto</a><br>
      <i class="fa-brands fa-google"></i> <a href="https://colab.research.google.com/drive/1KEAhe8Em4n8qsmEGmKABn-oEZ74im-ZB?usp=sharing">Notebook do desenvolvimento do projeto</a>
    </div>
  </body>
</html>
